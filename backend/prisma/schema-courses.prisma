// Course/Service Models - Add to end of main schema.prisma

enum CourseLevel {
  beginner
  intermediate
  advanced
  all_levels
}

enum CourseTierType {
  basic
  standard
  premium
  custom
}

enum PackageType {
  single_session
  package_5
  package_10
  package_20
  monthly
  custom
}

model Course {
  id              String        @id @default(uuid())
  tutorId         String        @map("tutor_id")
  title           String
  slug            String        @unique
  description     String?       @db.Text
  shortDescription String?      @map("short_description")
  thumbnailUrl    String?       @map("thumbnail_url")
  coverImageUrl   String?       @map("cover_image_url")
  category        String?
  level           CourseLevel   @default(all_levels)
  language        String        @default("Indonesian")
  isActive        Boolean       @default(true) @map("is_active")
  isFeatured      Boolean       @default(false) @map("is_featured")
  totalStudents   Int           @default(0) @map("total_students")
  averageRating   Decimal?      @map("average_rating") @db.Decimal(3, 2)
  totalReviews    Int           @default(0) @map("total_reviews")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  tutor           TutorProfile  @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  tiers           CourseTier[]
  packages        CoursePackage[]
  images          CourseImage[]

  @@index([tutorId])
  @@index([slug])
  @@index([isActive])
  @@index([category])
  @@index([level])
  @@map("courses")
}

model CourseTier {
  id              String         @id @default(uuid())
  courseId        String         @map("course_id")
  name            String
  type            CourseTierType @default(custom)
  description     String?        @db.Text
  features        String[]
  price           Decimal        @db.Decimal(10, 2)
  discountPrice   Decimal?       @map("discount_price") @db.Decimal(10, 2)
  isPopular       Boolean        @default(false) @map("is_popular")
  sortOrder       Int            @default(0) @map("sort_order")
  isActive        Boolean        @default(true) @map("is_active")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  course          Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
  packages        CoursePackage[]

  @@index([courseId])
  @@index([type])
  @@map("course_tiers")
}

model CoursePackage {
  id                String      @id @default(uuid())
  courseId          String      @map("course_id")
  tierId            String?     @map("tier_id")
  name              String
  type              PackageType @default(custom)
  description       String?     @db.Text
  sessionsIncluded  Int         @map("sessions_included")
  durationDays      Int?        @map("duration_days")
  price             Decimal     @db.Decimal(10, 2)
  discountPrice     Decimal?    @map("discount_price") @db.Decimal(10, 2)
  discountPercent   Int?        @map("discount_percent")
  features          String[]
  isFreeTrialAvailable Boolean  @default(false) @map("is_free_trial_available")
  freeTrialSessions Int?        @map("free_trial_sessions")
  freeTrialDuration Int?        @map("free_trial_duration")
  isActive          Boolean     @default(true) @map("is_active")
  sortOrder         Int         @default(0) @map("sort_order")
  createdAt         DateTime    @default(now()) @map("created_at")
  updatedAt         DateTime    @updatedAt @map("updated_at")

  course            Course      @relation(fields: [courseId], references: [id], onDelete: Cascade)
  tier              CourseTier? @relation(fields: [tierId], references: [id], onDelete: SetNull)
  purchases         PackagePurchase[]

  @@index([courseId])
  @@index([tierId])
  @@index([type])
  @@map("course_packages")
}

model CourseImage {
  id          String   @id @default(uuid())
  courseId    String   @map("course_id")
  imageUrl    String   @map("image_url")
  caption     String?
  sortOrder   Int      @default(0) @map("sort_order")
  createdAt   DateTime @default(now()) @map("created_at")

  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@map("course_images")
}

model PackagePurchase {
  id              String        @id @default(uuid())
  userId          String        @map("user_id")
  packageId       String        @map("package_id")
  sessionsTotal   Int           @map("sessions_total")
  sessionsUsed    Int           @default(0) @map("sessions_used")
  expiresAt       DateTime?     @map("expires_at")
  purchasedAt     DateTime      @default(now()) @map("purchased_at")
  status          String        @default("active")

  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  package         CoursePackage @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([packageId])
  @@index([status])
  @@map("package_purchases")
}
