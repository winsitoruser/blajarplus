generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  student
  tutor
  admin
}

enum UserStatus {
  active
  suspended
  deleted
}

model User {
  id            String    @id @default(uuid())
  email         String?   @unique
  phone         String?   @unique
  passwordHash  String?   @map("password_hash")
  fullName      String    @map("full_name")
  avatarUrl     String?   @map("avatar_url")
  gender        String?
  birthdate     DateTime?
  role          UserRole
  status        UserStatus @default(active)
  lastLoginAt   DateTime?  @map("last_login_at")
  createdAt     DateTime   @default(now()) @map("created_at")
  updatedAt     DateTime   @updatedAt @map("updated_at")

  // Relations
  addresses         UserAddress[]
  tutorProfile      TutorProfile?
  studentBookings   Booking[]        @relation("StudentBookings")
  sentMessages      Message[]
  authoredReviews   Review[]
  favorites         Favorite[]
  notifications     Notification[]
  studentProgress   ProgressLog[]    @relation("StudentProgress")
  packagePurchases  PackagePurchase[]
  reports           Report[]
  wallet            Wallet?
  studentMaterials  StudentMaterial[] @relation("StudentMaterials")
  
  // Gamification Relations
  userAchievements  UserAchievement[]
  userProgress      UserProgress?
  learningHistory   LearningHistory[]

  @@index([email])
  @@index([phone])
  @@index([role])
  @@index([status])
  @@map("users")
}

model UserAddress {
  id             String   @id @default(uuid())
  userId         String   @map("user_id")
  label          String?
  province       String?
  city           String?
  district       String?
  addressDetail  String?  @map("address_detail")
  lat            Decimal? 
  lng            Decimal? 
  isPrimary      Boolean  @default(false) @map("is_primary")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([city])
  @@map("user_addresses")
}

enum VerificationStatus {
  none
  pending
  approved
  rejected
}

enum TutorStatus {
  draft
  active
  inactive
  banned
}

model TutorProfile {
  id                     String             @id @default(uuid())
  userId                 String             @unique @map("user_id")
  headline               String?
  bio                    String?
  education              String?
  experienceYears        Int?               @map("experience_years")
  teachingModes          String[]           @map("teaching_modes")
  baseCity               String?            @map("base_city")
  timezone               String             @default("Asia/Jakarta")
  introVideoUrl          String?            @map("intro_video_url")
  hourlyRate             Decimal            @map("hourly_rate") 
  currency               String             @default("IDR")
  isVerified             Boolean            @default(false) @map("is_verified")
  verificationStatus     VerificationStatus @default(none) @map("verification_status")
  verificationNote       String?            @map("verification_note")
  ratingAvg              Decimal            @default(0.0) @map("rating_avg") 
  ratingCount            Int                @default(0) @map("rating_count")
  completedLessonsCount  Int                @default(0) @map("completed_lessons_count")
  responseRate           Int                @default(0) @map("response_rate")
  offerFreeTrial         Boolean            @default(false) @map("offer_free_trial")
  freeTrialDuration      Int?               @map("free_trial_duration")
  status                 TutorStatus        @default(draft)
  createdAt              DateTime           @default(now()) @map("created_at")
  updatedAt              DateTime           @updatedAt @map("updated_at")

  user              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  subjects          TutorSubject[]
  availabilities    TutorAvailability[]
  documents         TutorDocument[]
  bookings          Booking[]
  reviews           Review[]
  progressLogs      ProgressLog[]       @relation("TutorProgress")
  conversations     Conversation[]
  packages          LessonPackage[]
  timeOffs          TutorTimeOff[]
  withdrawals       Withdrawal[]
  syllabi           Syllabus[]

  @@index([userId])
  @@index([baseCity])
  @@index([hourlyRate])
  @@index([ratingAvg])
  @@index([verificationStatus])
  @@index([status])
  @@map("tutor_profiles")
}

model SubjectCategory {
  id        String    @id @default(uuid())
  name      String
  slug      String    @unique
  isActive  Boolean   @default(true) @map("is_active")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  subjects Subject[]

  @@index([slug])
  @@map("subject_categories")
}

model Subject {
  id         String   @id @default(uuid())
  name       String
  slug       String   @unique
  categoryId String?  @map("category_id")
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  category      SubjectCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  tutorSubjects TutorSubject[]

  @@index([slug])
  @@index([categoryId])
  @@index([isActive])
  @@map("subjects")
}

enum Level {
  sd
  smp
  sma
  university
  professional
  general
}

model TutorSubject {
  id            String   @id @default(uuid())
  tutorId       String   @map("tutor_profile_id")
  subjectId     String   @map("subject_id")
  level         Level
  priceOverride Decimal? @map("price_override") 
  currency      String   @default("IDR")
  description   String?
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  tutor    TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  subject  Subject      @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@unique([tutorId, subjectId, level])
  @@index([tutorId])
  @@index([subjectId])
  @@index([level])
  @@map("tutor_subjects")
}

model TutorAvailability {
  id                 String   @id @default(uuid())
  tutorId            String   @map("tutor_profile_id")
  dayOfWeek          Int      @map("day_of_week")
  startTime          String   @map("start_time")
  endTime            String   @map("end_time")
  slotDurationMinutes Int     @default(60) @map("slot_duration_minutes")
  isActive           Boolean  @default(true) @map("is_active")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  tutor TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@index([dayOfWeek])
  @@index([isActive])
  @@map("tutor_availabilities")
}

model TutorTimeOff {
  id        String   @id @default(uuid())
  tutorId   String   @map("tutor_profile_id")
  startAt   DateTime @map("start_at")
  endAt     DateTime @map("end_at")
  reason    String?
  createdAt DateTime @default(now()) @map("created_at")

  tutor TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@index([startAt, endAt])
  @@map("tutor_time_offs")
}

enum DocumentType {
  ktp
  diploma
  certificate
  portfolio
  other
}

enum DocumentStatus {
  pending
  approved
  rejected
}

model TutorDocument {
  id         String         @id @default(uuid())
  tutorId    String         @map("tutor_profile_id")
  docType    DocumentType   @map("doc_type")
  fileUrl    String         @map("file_url")
  status     DocumentStatus @default(pending)
  reviewedBy String?        @map("reviewed_by")
  reviewedAt DateTime?      @map("reviewed_at")
  note       String?
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  tutor TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@index([status])
  @@map("tutor_documents")
}

enum BookingStatus {
  draft
  pending_payment
  confirmed
  reschedule_requested
  cancelled
  completed
  no_show
  disputed
}

enum LocationType {
  student_place
  tutor_place
  public_place
  online
}

enum CancelledBy {
  student
  tutor
  system
  admin
}

model Booking {
  id              String         @id @default(uuid())
  bookingNumber   String?        @unique @map("booking_number")
  studentId       String         @map("student_id")
  tutorId         String         @map("tutor_profile_id")
  tutorSubjectId  String?        @map("tutor_subject_id")
  mode            String?
  startAt         DateTime       @map("start_at")
  endAt           DateTime       @map("end_at")
  durationMinutes Int            @map("duration_minutes")
  locationType    LocationType?  @map("location_type")
  locationAddress String?        @map("location_address")
  lat             Decimal?       
  lng             Decimal?       
  meetingLink     String?        @map("meeting_link")
  status          BookingStatus  @default(draft)
  cancelledBy     CancelledBy?   @map("cancelled_by")
  cancelReason    String?        @map("cancel_reason")
  rescheduleReason String?       @map("reschedule_reason")
  price           Decimal        
  platformFee     Decimal        @map("platform_fee") 
  totalAmount     Decimal        @map("total_amount") 
  currency        String         @default("IDR")
  notes           String?
  completedAt     DateTime?      @map("completed_at")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  student       User             @relation("StudentBookings", fields: [studentId], references: [id], onDelete: Cascade)
  tutor         TutorProfile     @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  tutorSubject  TutorSubject?    @relation(fields: [tutorSubjectId], references: [id], onDelete: SetNull)
  payment       PaymentTransaction?
  statusLogs    BookingStatusLog[]
  progressLogs  ProgressLog[]
  review        Review?

  @@index([studentId])
  @@index([tutorId])
  @@index([startAt])
  @@index([status])
  @@index([createdAt])
  @@map("bookings")
}

model BookingStatusLog {
  id             String    @id @default(uuid())
  bookingId      String    @map("booking_id")
  fromStatus     String?   @map("from_status")
  toStatus       String    @map("to_status")
  changedByUserId String?  @map("changed_by_user_id")
  reason         String?
  createdAt      DateTime  @default(now()) @map("created_at")

  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([createdAt])
  @@map("booking_status_logs")
}

enum PaymentProvider {
  midtrans
  xendit
  manual
}

enum PaymentStatus {
  pending
  paid
  failed
  expired
  refunded
}

model PaymentTransaction {
  id                String          @id @default(uuid())
  bookingId         String          @unique @map("booking_id")
  provider          PaymentProvider
  paymentMethod     String?         @map("payment_method")
  externalPaymentId String?         @map("external_payment_id")
  status            PaymentStatus   @default(pending)
  amount            Decimal         
  currency          String          @default("IDR")
  paidAt            DateTime?       @map("paid_at")
  expiresAt         DateTime?       @map("expires_at")
  rawPayload        Json?           @map("raw_payload")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")

  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([status])
  @@index([externalPaymentId])
  @@map("payment_transactions")
}

model Wallet {
  id        String   @id @default(uuid())
  userId    String   @unique @map("user_id")
  balance   Decimal  @default(0.0) 
  currency  String   @default("IDR")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user    User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries WalletLedgerEntry[]

  @@index([userId])
  @@map("wallets")
}

enum LedgerEntryType {
  escrow_hold
  release_to_tutor
  platform_fee
  refund
  withdrawal
}

model WalletLedgerEntry {
  id          String          @id @default(uuid())
  walletId    String          @map("wallet_id")
  type        LedgerEntryType
  amount      Decimal         
  bookingId   String?         @map("booking_id")
  referenceId String?         @map("reference_id")
  meta        Json?
  createdAt   DateTime        @default(now()) @map("created_at")

  wallet Wallet @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@index([bookingId])
  @@index([type])
  @@index([createdAt])
  @@map("wallet_ledger_entries")
}

model Conversation {
  id            String    @id @default(uuid())
  studentId     String    @map("student_id")
  tutorId       String    @map("tutor_profile_id")
  lastMessageAt DateTime? @map("last_message_at")
  isBlocked     Boolean   @default(false) @map("is_blocked")
  blockedByUserId String? @map("blocked_by_user_id")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  tutor    TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  messages Message[]

  @@unique([studentId, tutorId])
  @@index([studentId])
  @@index([tutorId])
  @@index([lastMessageAt])
  @@map("conversations")
}

enum MessageType {
  text
  image
  file
}

model Message {
  id             String      @id @default(uuid())
  conversationId String      @map("conversation_id")
  senderUserId   String      @map("sender_user_id")
  messageType    MessageType @default(text) @map("message_type")
  content        String?
  fileUrl        String?     @map("file_url")
  readAt         DateTime?   @map("read_at")
  createdAt      DateTime    @default(now()) @map("created_at")

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User         @relation(fields: [senderUserId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderUserId])
  @@index([createdAt])
  @@map("messages")
}

enum ReviewStatus {
  published
  hidden
  removed
}

model Review {
  id               String       @id @default(uuid())
  bookingId        String       @unique @map("booking_id")
  tutorId          String       @map("tutor_profile_id")
  authorUserId     String       @map("author_user_id")
  rating           Int
  comment          String?
  status           ReviewStatus @default(published)
  moderatedBy      String?      @map("moderated_by")
  moderatedReason  String?      @map("moderated_reason")
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")

  booking Booking      @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  tutor   TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  author  User         @relation(fields: [authorUserId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([tutorId])
  @@index([authorUserId])
  @@index([rating])
  @@index([status])
  @@index([createdAt])
  @@map("reviews")
}

model ProgressLog {
  id            String   @id @default(uuid())
  bookingId     String   @map("booking_id")
  tutorId       String   @map("tutor_profile_id")
  studentId     String   @map("student_id")
  summary       String?
  homework      String?
  nextPlan      String?  @map("next_plan")
  attachmentUrl String?  @map("attachment_url")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  booking Booking      @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  tutor   TutorProfile @relation("TutorProgress", fields: [tutorId], references: [id], onDelete: Cascade)
  student User         @relation("StudentProgress", fields: [studentId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([studentId])
  @@index([tutorId])
  @@index([createdAt])
  @@map("progress_logs")
}

model Favorite {
  id        String   @id @default(uuid())
  studentId String   @map("student_id")
  tutorId   String   @map("tutor_profile_id")
  createdAt DateTime @default(now()) @map("created_at")

  student User @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, tutorId])
  @@index([studentId])
  @@index([tutorId])
  @@map("favorites")
}

model LessonPackage {
  id             String   @id @default(uuid())
  tutorId        String   @map("tutor_profile_id")
  tutorSubjectId String?  @map("tutor_subject_id")
  name           String
  sessionCount   Int      @map("session_count")
  totalPrice     Decimal  @map("total_price") 
  currency       String   @default("IDR")
  validDays      Int      @map("valid_days")
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  tutor     TutorProfile      @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  purchases PackagePurchase[]

  @@index([tutorId])
  @@index([isActive])
  @@map("lesson_packages")
}

enum PackageStatus {
  pending_payment
  active
  expired
  cancelled
}

model PackagePurchase {
  id                String        @id @default(uuid())
  studentId         String        @map("student_id")
  packageId         String        @map("lesson_package_id")
  status            PackageStatus @default(pending_payment)
  sessionsRemaining Int           @map("sessions_remaining")
  startAt           DateTime?     @map("start_at")
  expiresAt         DateTime?     @map("expires_at")
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  student User          @relation(fields: [studentId], references: [id], onDelete: Cascade)
  package LessonPackage @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([packageId])
  @@index([status])
  @@map("package_purchases")
}

enum ReportTargetType {
  user
  tutor_profile
  review
  message
  booking
}

enum ReportReason {
  spam
  fraud
  harassment
  inappropriate
  other
}

enum ReportStatus {
  open
  investigating
  resolved
  rejected
}

model Report {
  id          String           @id @default(uuid())
  reporterId  String           @map("reporter_user_id")
  targetType  ReportTargetType @map("target_type")
  targetId    String           @map("target_id")
  reason      ReportReason
  description String?
  status      ReportStatus     @default(open)
  handledBy   String?          @map("handled_by")
  handledAt   DateTime?        @map("handled_at")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  reporter User @relation(fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([reporterId])
  @@index([targetType, targetId])
  @@index([status])
  @@index([createdAt])
  @@map("reports")
}

model Notification {
  id        String    @id @default(uuid())
  userId    String    @map("user_id")
  type      String
  title     String
  message   String
  data      String?   @db.Text
  isRead    Boolean   @default(false) @map("is_read")
  readAt    DateTime? @map("read_at")
  createdAt DateTime  @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

enum WithdrawalStatus {
  pending
  approved
  rejected
  completed
}

model Withdrawal {
  id                String           @id @default(uuid())
  tutorId           String           @map("tutor_id")
  amount            Int
  bankName          String           @map("bank_name")
  bankAccountNumber String           @map("bank_account_number")
  bankAccountName   String           @map("bank_account_name")
  status            WithdrawalStatus @default(pending)
  rejectionReason   String?          @map("rejection_reason")
  processedAt       DateTime?        @map("processed_at")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  tutor TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@index([status])
  @@index([createdAt])
  @@map("withdrawals")
}

model Syllabus {
  id             String   @id @default(uuid())
  tutorId        String   @map("tutor_id")
  tutorSubjectId String   @map("tutor_subject_id")
  title          String
  description    String?  @db.Text
  topics         String[] @default([])
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  tutor     TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  materials Material[]

  @@index([tutorId])
  @@index([tutorSubjectId])
  @@map("syllabi")
}

model Material {
  id            String   @id @default(uuid())
  syllabusId    String   @map("syllabus_id")
  title         String
  content       String?  @db.Text
  order         Int      @default(0)
  attachmentUrl String?  @map("attachment_url")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  syllabus         Syllabus           @relation(fields: [syllabusId], references: [id], onDelete: Cascade)
  studentMaterials StudentMaterial[]

  @@index([syllabusId])
  @@index([order])
  @@map("materials")
}

enum MaterialStatus {
  not_started
  in_progress
  completed
}

model StudentMaterial {
  id         String         @id @default(uuid())
  studentId  String         @map("student_id")
  materialId String         @map("material_id")
  status     MaterialStatus @default(not_started)
  notes      String?        @db.Text
  completedAt DateTime?     @map("completed_at")
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  student  User     @relation("StudentMaterials", fields: [studentId], references: [id], onDelete: Cascade)
  material Material @relation(fields: [materialId], references: [id], onDelete: Cascade)

  @@unique([studentId, materialId])
  @@index([studentId])
  @@index([materialId])
  @@index([status])
  @@map("student_materials")
}

enum BannerType {
  info
  warning
  success
  promotion
}

enum BannerTarget {
  all
  student
  tutor
}

model Banner {
  id          String       @id @default(uuid())
  title       String
  description String?      @db.Text
  imageUrl    String?      @map("image_url")
  linkUrl     String?      @map("link_url")
  type        BannerType   @default(info)
  target      BannerTarget @default(all)
  isActive    Boolean      @default(true) @map("is_active")
  order       Int          @default(0)
  startDate   DateTime?    @map("start_date")
  endDate     DateTime?    @map("end_date")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  @@index([isActive])
  @@index([target])
  @@index([order])
  @@index([startDate])
  @@index([endDate])
  @@map("banners")
}

// Gamification System Models
enum AchievementType {
  milestone
  streak
  completion
  social
  special
}

enum AchievementCategory {
  learning
  engagement
  social
  progress
  special
}

model Achievement {
  id          String              @id @default(uuid())
  name        String
  description String              @db.Text
  type        AchievementType
  category    AchievementCategory
  icon        String?
  points      Int                 @default(0)
  requirement Int                 @default(1)
  isActive    Boolean             @default(true) @map("is_active")
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")

  userAchievements UserAchievement[]

  @@index([type])
  @@index([category])
  @@index([isActive])
  @@map("achievements")
}

model UserAchievement {
  id            String      @id @default(uuid())
  userId        String      @map("user_id")
  achievementId String      @map("achievement_id")
  progress      Int         @default(0)
  isCompleted   Boolean     @default(false) @map("is_completed")
  completedAt   DateTime?   @map("completed_at")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievement Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
  @@index([achievementId])
  @@index([isCompleted])
  @@map("user_achievements")
}

model UserProgress {
  id              String   @id @default(uuid())
  userId          String   @unique @map("user_id")
  level           Int      @default(1)
  xp              Int      @default(0)
  totalXp         Int      @default(0) @map("total_xp")
  streak          Int      @default(0)
  longestStreak   Int      @default(0) @map("longest_streak")
  lastActiveDate  DateTime @default(now()) @map("last_active_date")
  totalSessions   Int      @default(0) @map("total_sessions")
  totalHours      Float    @default(0) @map("total_hours")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([level])
  @@map("user_progress")
}

model LearningHistory {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  activityType String  @map("activity_type")
  description String   @db.Text
  xpEarned    Int      @default(0) @map("xp_earned")
  metadata    Json?
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([activityType])
  @@index([createdAt])
  @@map("learning_history")
}
